# 照片水印添加程序 - 工作计划

## 项目概述
开发一个 Python 命令行程序，为照片添加基于 EXIF 拍摄日期的水印。

## 开发阶段

### 阶段 1：项目设置和环境准备
**预计时间：30 分钟**

1. **创建项目结构**
   - [x] 创建 PRD 文档
   - [x] 创建工作计划文档
   - [ ] 创建 `requirements.txt` 文件
   - [ ] 创建主程序文件 `watermark.py`
   - [ ] 更新 `README.md` 文件

2. **依赖管理**
   - [ ] 确定所需的 Python 包
   - [ ] 创建虚拟环境（测试用）
   - [ ] 安装和测试依赖包

### 阶段 2：核心功能开发
**预计时间：2-3 小时**

3. **EXIF 数据处理模块**
   - [ ] 实现 EXIF 数据读取功能
   - [ ] 提取拍摄日期信息
   - [ ] 日期格式化处理
   - [ ] 处理无 EXIF 数据的情况

4. **图像处理模块**
   - [ ] 图片加载和验证
   - [ ] 水印文本绘制功能
   - [ ] 位置计算算法
   - [ ] 字体和颜色处理

5. **文件管理模块**
   - [ ] 输入路径处理（文件/目录）
   - [ ] 输出目录创建
   - [ ] 文件保存逻辑
   - [ ] 批量处理功能

### 阶段 3：命令行接口开发
**预计时间：1 小时**

6. **CLI 接口实现**
   - [ ] 参数解析设置
   - [ ] 用户输入验证
   - [ ] 帮助信息显示
   - [ ] 进度提示功能

### 阶段 4：错误处理和优化
**预计时间：1 小时**

7. **错误处理**
   - [ ] 输入验证和错误提示
   - [ ] 文件访问权限检查
   - [ ] EXIF 数据异常处理
   - [ ] 内存和性能优化

8. **代码优化**
   - [ ] 代码重构和模块化
   - [ ] 性能优化
   - [ ] 内存使用优化

### 阶段 5：测试和文档
**预计时间：1 小时**

9. **测试**
   - [ ] 创建测试图片样本
   - [ ] 手动功能测试
   - [ ] 边界情况测试
   - [ ] 性能测试

10. **文档完善**
    - [ ] 更新 README.md
    - [ ] 添加使用示例
    - [ ] 创建安装指南
    - [ ] 代码注释完善

## 技术实现细节

### 核心模块设计

1. **ExifReader 类**
   ```python
   class ExifReader:
       def extract_date(self, image_path)
       def format_date(self, date_string)
   ```

2. **WatermarkGenerator 类**
   ```python
   class WatermarkGenerator:
       def __init__(self, font_size, color, position)
       def apply_watermark(self, image, text)
   ```

3. **FileProcessor 类**
   ```python
   class FileProcessor:
       def process_single_file(self, file_path, output_dir)
       def process_directory(self, dir_path)
       def create_output_directory(self, base_path)
   ```

### 依赖库选择

- **Pillow (PIL)**：主要的图像处理库
  - 图片读取和保存
  - 文本绘制
  - EXIF 数据读取
- **argparse**：命令行参数解析（Python 标准库）
- **pathlib**：路径处理（Python 标准库）
- **datetime**：日期处理（Python 标准库）

### 文件结构计划

```
ai4se-photo-watermark/
├── watermark.py          # 主程序文件
├── requirements.txt      # 依赖包列表
├── README.md            # 使用说明
├── PRD.md              # 产品需求文档
├── WORKPLAN.md         # 工作计划文档
├── LICENSE             # 许可证文件
└── .gitignore          # Git 忽略文件
```

## 开发优先级

### 高优先级（必须实现）
1. EXIF 日期提取
2. 基本水印功能
3. 文件输入输出处理
4. 命令行接口

### 中优先级（重要功能）
1. 多种位置选项
2. 字体颜色自定义
3. 批量处理
4. 错误处理

### 低优先级（可选功能）
1. 高级字体选项
2. 文字特效（阴影、描边）
3. 进度条显示
4. 配置文件支持

## 风险和缓解措施

### 技术风险
1. **EXIF 数据缺失或损坏**
   - 缓解：提供降级策略（使用文件时间戳）
   
2. **大文件内存占用**
   - 缓解：分块处理，内存限制检查

3. **字体兼容性问题**
   - 缓解：使用系统默认字体，提供字体检查

### 时间风险
1. **开发时间估算不准确**
   - 缓解：分阶段开发，优先核心功能

## 质量标准

1. **代码质量**
   - 遵循 PEP 8 规范
   - 函数和类有清晰的文档字符串
   - 适当的错误处理

2. **用户体验**
   - 清晰的命令行界面
   - 友好的错误消息
   - 合理的默认设置

3. **功能完整性**
   - 所有核心功能正常工作
   - 边界情况得到处理
   - 支持常见的使用场景

## 交付检查清单

- [ ] 程序能够读取 JPEG 图片的 EXIF 日期
- [ ] 能够在图片上添加日期水印
- [ ] 支持字体大小、颜色、位置自定义
- [ ] 能够处理目录中的多个图片文件
- [ ] 创建正确的输出目录结构
- [ ] 命令行界面工作正常
- [ ] 提供清晰的错误消息
- [ ] 文档完整且准确
- [ ] 代码符合质量标准