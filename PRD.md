# 照片水印添加程序 - 产品需求文档 (PRD)

## 产品概述

开发一个 Python 命令行程序，能够自动为照片添加基于 EXIF 拍摄日期的水印。程序将读取照片的元数据信息，提取拍摄日期，并以用户指定的样式将日期作为水印添加到照片上。

## 功能需求

### 核心功能

1. **照片输入处理**
   - 用户通过命令行指定照片文件路径（支持单个文件或目录）
   - 支持常见图片格式：JPEG、PNG、TIFF、BMP
   - 自动识别并处理目录中的所有图片文件

2. **EXIF 数据提取**
   - 读取图片文件的 EXIF 元数据
   - 提取拍摄时间信息（DateTimeOriginal、DateTime、DateTimeDigitized）
   - 将日期格式化为年-月-日格式（YYYY-MM-DD）
   - 处理缺失 EXIF 数据的情况

3. **水印自定义设置**
   - **字体大小**：用户可指定字体大小（默认：48px）
   - **字体颜色**：支持常见颜色名称和十六进制颜色代码（默认：白色）
   - **位置设置**：支持以下位置选项
     - 左上角 (top-left)
     - 居中 (center)
     - 右下角 (bottom-right)
     - 左下角 (bottom-left)
     - 右上角 (top-right)

4. **水印应用**
   - 在指定位置绘制日期文本水印
   - 保持水印可读性（添加文字阴影或描边效果）
   - 保持原图质量

5. **文件输出管理**
   - 在原目录下创建 `原目录名_watermark` 子目录
   - 将带水印的图片保存到新目录中
   - 保持原始文件名（或添加后缀标识）
   - 不修改原始图片文件

## 技术需求

### 依赖库
- **Pillow (PIL)**：图像处理和文本绘制
- **exifread** 或 **Pillow EXIF**：EXIF 数据提取
- **argparse**：命令行参数解析
- **pathlib**：文件路径处理
- **datetime**：日期时间处理

### 系统要求
- Python 3.7+
- 支持 Windows、macOS、Linux

## 用户界面需求

### 命令行接口
```bash
python watermark.py <input_path> [options]

参数：
  input_path          输入图片文件或目录路径

选项：
  --font-size SIZE    字体大小（默认：48）
  --color COLOR       字体颜色（默认：white）
  --position POS      水印位置（默认：bottom-right）
                      可选：top-left, top-right, center, bottom-left, bottom-right
  --help              显示帮助信息
```

### 使用示例
```bash
# 处理单个文件
python watermark.py /path/to/photo.jpg

# 处理目录中所有图片
python watermark.py /path/to/photos/

# 自定义水印样式
python watermark.py /path/to/photos/ --font-size 36 --color red --position top-left
```

## 错误处理需求

1. **输入验证**
   - 检查输入路径是否存在
   - 验证文件是否为支持的图片格式
   - 检查目录访问权限

2. **EXIF 处理**
   - 处理无 EXIF 数据的图片（使用文件修改时间或跳过）
   - 处理损坏的 EXIF 数据

3. **输出处理**
   - 检查输出目录创建权限
   - 处理文件名冲突
   - 磁盘空间检查

## 性能需求

- 处理速度：每张图片处理时间 < 5 秒
- 内存使用：支持处理大尺寸图片（不超过可用内存的 50%）
- 批量处理：支持同时处理 100+ 张图片

## 质量需求

1. **代码质量**
   - 遵循 PEP 8 编码规范
   - 添加适当的注释和文档字符串
   - 模块化设计，便于维护

2. **用户体验**
   - 提供清晰的进度提示
   - 友好的错误消息
   - 详细的帮助文档

3. **可扩展性**
   - 支持后续添加更多水印样式
   - 支持更多图片格式
   - 支持更多水印位置选项

## 交付物

1. **核心程序**
   - `watermark.py` - 主程序文件
   - `requirements.txt` - 依赖说明
   - `README.md` - 使用说明

2. **文档**
   - 安装和使用指南
   - API 文档（如果有）
   - 示例和最佳实践

3. **测试**
   - 单元测试（可选）
   - 集成测试示例

## 验收标准

1. 能够成功读取 JPEG 图片的 EXIF 拍摄日期
2. 能够在指定位置添加日期水印
3. 能够批量处理目录中的多张图片
4. 生成的水印图片保存在正确的子目录中
5. 原始图片文件保持不变
6. 命令行参数正确解析和应用
7. 错误情况下显示友好的错误信息