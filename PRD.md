# 水印文件本地应用需求文档

## 项目概述

基于 Python 开发的跨平台（Windows/macOS/Linux）桌面水印处理应用程序，支持为图片批量添加文本或图片水印，提供直观的图形界面和实时预览功能，满足用户的个性化水印需求。

## 功能需求

### 1. 文件处理模块

#### 1.1 图片导入功能

- **单张导入**：支持拖拽文件到应用界面或通过文件选择器选择单张图片
- **批量导入**：
  - 一次性选择多张图片文件
  - 直接导入整个文件夹及其子文件夹中的图片
- **界面展示**：在主界面显示已导入图片的列表，包含缩略图和文件名
- **列表管理**：支持添加、删除已导入的图片

#### 1.2 图片格式支持

- **输入格式**：
  - 必须支持：JPEG (.jpg, .jpeg)、PNG (.png)
  - 强烈建议支持：BMP (.bmp)、TIFF (.tif, .tiff)
  - PNG格式必须完整支持透明通道处理
- **输出格式**：用户可选择输出为 JPEG 或 PNG 格式或其他格式

#### 1.3 图片导出功能

- **输出路径**：
  - 用户指定输出文件夹
  - 默认禁止导出到原文件夹，防止覆盖原图
  - 提供安全提示和确认机制
- **文件命名规则**：
  - 保留原文件名
  - 添加自定义前缀（如 "wm_"）
  - 添加自定义后缀（如 "_watermarked"）
- **质量控制**：
  - JPEG格式提供压缩质量滑块（0-100），默认85
  - PNG格式保持无损压缩
- **尺寸调整**：
  - 按宽度缩放
  - 按高度缩放
  - 按百分比缩放
  - 保持原始尺寸

### 2. 水印类型模块

#### 2.1 文本水印

- **文本内容**：用户可输入任意文本内容，支持多行文本
- **字体设置**：
  - 字体选择：从系统已安装字体中选择
  - 字号设置：支持范围 8-200px
  - 字体样式：粗体、斜体、下划线
- **颜色配置**：
  - 调色板选择字体颜色
  - 支持RGB、十六进制色值输入
  - 颜色历史记录
- **透明度控制**：0-100% 可调节透明度滑块
- **视觉效果**：
  - 阴影效果：支持阴影偏移、模糊半径、颜色设置
  - 描边效果：支持描边宽度、颜色设置
  - 提升文本在复杂背景下的可读性

#### 2.2 图片水印

- **水印图片选择**：从本地文件系统选择图片作为水印
- **格式支持**：必须支持带透明通道的PNG图片，同时支持JPG、BMP等格式
- **尺寸控制**：
  - 等比例缩放
  - 自由缩放（可调整宽高比）
  - 基于目标图片的相对大小设置
- **透明度调节**：0-100% 整体透明度控制

### 3. 水印布局与样式模块

#### 3.1 实时预览功能

- **主预览窗口**：显示当前选中图片的水印效果
- **实时更新**：所有水印参数调整立即在预览中反映
- **图片切换**：点击图片列表可切换预览不同图片
- **缩放控制**：支持预览图片的放大、缩小、适应窗口

#### 3.2 水印位置控制

- **九宫格布局**：
  - 左上角、正上方、右上角
  - 左中、正中心、右中
  - 左下角、正下方、右下角
- **自由拖拽**：
  - 在预览图上直接拖拽水印到任意位置
  - 显示辅助对齐线
  - 支持精确的像素级定位

#### 3.3 水印变换

- **旋转控制**：
  - 旋转滑块：-180° 到 +180°
  - 数值输入框：精确角度输入
  - 常用角度快捷按钮（0°、45°、90°、135°、180°）
- **缩放控制**：独立于位置的缩放设置

### 4. 配置管理模块

#### 4.1 水印模板系统

- **模板保存**：
  - 保存当前所有水印设置为模板
  - 包含：水印内容、字体、颜色、位置、大小、透明度、效果等
  - 模板命名和描述
- **模板管理**：
  - 模板列表查看
  - 模板加载应用
  - 模板删除功能
  - 模板导入导出
- **自动保存**：
  - 程序启动时自动加载上次关闭时的设置
  - 支持默认模板设置

## 非功能需求

### 5. 用户体验

- **界面语言**：中文界面，支持多语言扩展
- **响应性能**：预览更新延迟不超过500ms
- **操作便捷**：支持键盘快捷键，拖拽操作
- **错误处理**：友好的错误提示和异常处理

### 6. 性能要求

- **内存管理**：大批量图片处理时的内存优化
- **处理速度**：单张图片水印处理时间不超过3秒
- **文件大小**：支持最大50MB的单张图片文件

### 7. 兼容性

- **操作系统**：Windows 10+, macOS 10.14+, Ubuntu 18.04+
- **Python版本**：Python 3.11.4
- **图片格式**：完整支持主流图片格式的读写

### 8. 安全性

- **文件安全**：原始文件不被修改，仅生成新文件
- **路径验证**：防止路径注入和非法文件访问
- **异常恢复**：处理过程中断时的恢复机制

## 技术约束

### 9. 开发环境

- **编程语言**：Python 3.11.4
- **虚拟环境**：使用项目现有的venv环境
- **GUI框架**：建议使用 Tkinter（标准库）或 PyQt/PySide
- **图像处理**：PIL/Pillow 库
- **打包部署**：PyInstaller 进行跨平台打包

### 10. 项目结构

- **代码组织**：采用模块化设计，分离界面和业务逻辑
- **配置存储**：使用JSON格式存储用户配置和模板
- **日志系统**：完整的日志记录系统
- **错误处理**：统一的异常处理机制

## 验收标准

### 11. 功能验收

- [ ] 支持主流图片格式的导入和处理
- [ ] 文本水印和图片水印功能完整可用
- [ ] 实时预览功能正常工作
- [ ] 九宫格定位和自由拖拽功能
- [ ] 批量处理功能稳定
- [ ] 模板保存和加载功能
- [ ] 跨平台兼容性测试通过

### 12. 性能验收

- [ ] 单张图片处理时间符合要求
- [ ] 大批量处理内存占用合理
- [ ] 界面响应流畅，无明显卡顿

### 13. 用户体验验收

- [ ] 界面美观、操作直观
- [ ] 错误提示清晰友好
- [ ] 帮助文档完整
- [ ] 用户反馈收集和处理机制

---

*本需求文档版本：v1.0*  
*创建日期：2025年10月3日*  
*最后更新：2025年10月3日*
