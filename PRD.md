# 水印工具产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品简介

水印工具是一个跨平台的桌面应用程序，支持 Windows、macOS 和 Linux 系统。该工具为用户提供直观易用的图形界面，帮助用户快速为图片添加文本或图片水印，支持批量处理和实时预览功能。

### 1.2 目标用户

- 摄影师和设计师
- 内容创作者
- 企业品牌宣传人员
- 需要批量处理图片水印的用户

### 1.3 核心价值

- 简单易用的图形界面
- 实时预览水印效果
- 支持批量处理
- 跨平台兼容性
- 丰富的水印自定义选项

## 2. 功能需求

### 2.1 文件处理

#### 2.1.1 导入图片

**基础功能：**

- 支持单张图片拖拽导入
- 支持通过文件选择器导入单张图片
- 支持批量选择多张图片
- 支持直接导入整个文件夹
- 在界面显示已导入图片列表，包含缩略图和文件名
- 支持删除列表中的图片

**交互设计：**

- 主界面提供明显的导入区域，支持拖拽操作
- 提供"添加文件"和"添加文件夹"按钮
- 图片列表应可滚动，每个条目显示缩略图、文件名和文件大小
- 支持点击列表项目切换预览

#### 2.1.2 支持格式

**必须支持的输入格式：**

- JPEG (.jpg, .jpeg)
- PNG (.png) - 必须支持透明通道

**强烈建议支持的输入格式：**

- BMP (.bmp)
- TIFF (.tif, .tiff)

**输出格式：**

- JPEG - 用户可选择
- PNG - 用户可选择，保持透明通道

#### 2.1.3 导出图片

**基础功能：**

- 用户指定输出文件夹
- 默认禁止导出到原文件夹（防止覆盖）
- 提供覆盖警告机制

**文件命名规则：**

- 保留原文件名
- 添加自定义前缀（如 "wm_"）
- 添加自定义后缀（如 "_watermarked"）
- 支持自动编号防止重名

**高级功能（可选）：**

- JPEG 质量调节滑块（0-100）
- 图片尺寸调整（按宽度、高度或百分比缩放）
- 批量导出进度显示

### 2.2 水印类型

#### 2.2.1 文本水印

**基础功能：**

- 自定义文本输入
- 字体大小调节
- 透明度调节（0-100%）

**高级功能（可选）：**

- 系统字体选择
- 粗体、斜体样式
- 调色板颜色选择
- 阴影效果
- 描边效果

#### 2.2.2 图片水印（高级功能）

- 本地图片选择作为水印
- 支持带透明通道的 PNG
- 比例缩放和自由调整大小
- 透明度调节（0-100%）

### 2.3 水印布局与样式

#### 2.3.1 实时预览

- 所有水印调整实时显示在预览窗口
- 支持点击图片列表切换预览不同图片
- 预览区域支持缩放查看细节

#### 2.3.2 位置控制

**预设位置：**

- 九宫格布局（左上、上中、右上、左中、正中、右中、左下、下中、右下）
- 一键快速定位

**手动定位：**

- 鼠标拖拽水印到任意位置
- 精确坐标输入
- 网格对齐辅助

#### 2.3.3 高级样式（可选）

- 旋转角度调节（-360° 到 +360°）
- 水印大小调节
- 多水印支持

### 2.4 配置管理

#### 2.4.1 水印模板

- 保存当前水印设置为模板
- 加载已保存的模板
- 管理和删除模板
- 模板导入/导出功能

#### 2.4.2 应用设置

- 自动加载上次使用的设置
- 默认模板设置
- 界面语言选择（中文/英文）
- 主题切换（明亮/暗黑模式）

## 3. 非功能需求

### 3.1 性能要求

- 图片预览加载时间 < 2 秒
- 批量处理支持进度显示和取消操作
- 内存使用优化，避免大图片导致程序崩溃
- 支持多线程处理提升批量操作效率

### 3.2 兼容性要求

- Windows 10/11
- macOS 10.14+  
- Ubuntu 18.04+ 或其他主流 Linux 发行版
- 支持 4K 高分辨率显示器

### 3.3 用户体验

- 界面响应流畅，操作直观
- 提供操作提示和帮助文档
- 错误处理友好，提供明确的错误信息
- 支持键盘快捷键操作

### 3.4 稳定性

- 程序崩溃率 < 0.1%
- 支持异常恢复和自动保存
- 内存泄漏控制

## 4. 技术架构

### 4.1 技术栈选择

- **GUI框架**: PyQt6 或 Tkinter（Python内置）
- **图像处理**: Pillow (PIL)
- **打包工具**: PyInstaller 或 cx_Freeze
- **开发语言**: Python 3.8+

### 4.2 项目结构

```
src/
├── main.py                 # 应用程序入口
├── watermark_app/          # 主应用包
│   ├── __init__.py
│   ├── app.py              # 应用程序主类
│   ├── gui/                # GUI组件
│   │   ├── __init__.py
│   │   ├── main_window.py  # 主窗口
│   │   ├── widgets/        # 自定义组件
│   │   │   ├── __init__.py
│   │   │   ├── file_list.py      # 文件列表组件
│   │   │   ├── preview_panel.py  # 预览面板
│   │   │   ├── watermark_panel.py # 水印设置面板
│   │   │   └── export_dialog.py  # 导出对话框
│   │   └── dialogs/        # 对话框
│   │       ├── __init__.py
│   │       ├── settings.py       # 设置对话框
│   │       └── about.py          # 关于对话框
│   ├── core/               # 核心功能模块
│   │   ├── __init__.py
│   │   ├── image_processor.py    # 图像处理
│   │   ├── watermark.py          # 水印处理
│   │   ├── file_manager.py       # 文件管理
│   │   └── exporter.py           # 导出处理
│   ├── config/             # 配置管理
│   │   ├── __init__.py
│   │   ├── settings.py           # 应用设置
│   │   ├── templates.py          # 模板管理
│   │   └── defaults.py           # 默认配置
│   └── utils/              # 工具函数
│       ├── __init__.py
│       ├── validators.py         # 输入验证
│       ├── helpers.py            # 辅助函数
│       └── constants.py          # 常量定义
```

### 4.3 部署要求

- 提供Windows .exe 安装包
- 提供macOS .dmg 安装包  
- 提供Linux .AppImage 或 .deb 包
- 所有版本通过 GitHub Release 发布

## 5. 开发优先级

### 5.1 MVP (最小可行产品)

1. 基础图片导入（单张、批量）
2. 简单文本水印
3. 九宫格位置预设
4. 基础导出功能
5. 实时预览

### 5.2 第二阶段

1. 手动拖拽定位
2. 透明度调节
3. 模板保存/加载
4. 批量处理优化

### 5.3 第三阶段

1. 图片水印功能
2. 高级文本样式
3. 旋转功能
4. 高级导出选项

## 6. 验收标准

### 6.1 功能验收

- [ ] 成功导入并预览各种格式图片
- [ ] 文本水印正确显示和定位
- [ ] 批量处理功能正常工作
- [ ] 导出图片质量和格式正确
- [ ] 模板管理功能完整

### 6.2 性能验收

- [ ] 单张图片预览加载 < 2 秒
- [ ] 批量处理 1000 张图片能正常完成
- [ ] 内存使用稳定，无明显泄漏
- [ ] 界面操作响应 < 100ms

### 6.3 兼容性验收

- [ ] Windows 10/11 正常运行
- [ ] macOS 最新版本正常运行
- [ ] Ubuntu LTS 版本正常运行
- [ ] 4K显示器界面正常显示

## 7. 风险评估

### 7.1 技术风险

- **图像处理性能**: 大图片处理可能导致内存不足
- **跨平台兼容性**: 不同系统的字体和界面差异
- **打包体积**: 包含 GUI 库后安装包可能较大

### 7.2 缓解措施

- 实现图片压缩和分块处理
- 充分测试各平台兼容性
- 优化依赖库，减小打包体积
- 提供在线版本作为备选方案

## 8. 后续规划

### 8.1 功能扩展

- 视频水印支持
- 云端模板库
- 批量水印样式
- AI 自动水印定位

### 8.2 商业化考虑

- 免费版本基础功能
- 付费版本高级功能
- 企业版批量许可
- 在线服务订阅模式
